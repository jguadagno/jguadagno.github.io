<!-- Replaced entire file with my updated version. Dan's Customizations START and END for entire file.
	Google Analytics introduced new required consent tags in 2023, so we had to update the code to account for them.
	More info: https://developers.google.com/tag-platform/security/guides/consent?consentmode=basic#gtag.js
-->

<script>
	window.dataLayer = window.dataLayer || [];
	function gtag() { dataLayer.push(arguments); }

	// Consent not granted by default.
	gtag('consent', 'default', {
		'ad_user_data': 'denied',
		'ad_personalization': 'denied',
		'ad_storage': 'denied',
		'analytics_storage': 'denied',
		// Wait 500ms to allow consent function to update consent values before calling Google Analytics.
		'wait_for_update': 500,
	});

	gtag('js', new Date());
	gtag('config', '{{ site.analytics.google.tracking_id }}', {
			'anonymize_ip': {{ site.analytics.google.anonymize_ip | default: false }}
		});
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.analytics.google.tracking_id }}"></script>
<script>
	function RunGoogleAnalyticsJavaScript()
	{
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }

		// Update consent values from denied to granted.
		gtag('consent', 'update', {
			ad_user_data: 'granted',
			ad_personalization: 'granted',
			ad_storage: 'granted',
			analytics_storage: 'granted'
		});
	}
</script>
